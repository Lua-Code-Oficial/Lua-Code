<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lua Code üåï</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --sidebar-bg: #2d2d2d;
            --border-color: #333333;
            --text-main: #d4d4d4;
        }

        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            background-color: var(--bg-color);
            font-family: 'Consolas', 'Monaco', monospace;
            overflow: hidden;
            color: var(--text-main);
        }

        .container { display: flex; flex-direction: column; height: 100vh; }

        header {
            height: 45px; background: #2d2d2d;
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; padding: 0 20px;
            font-size: 16px; font-weight: bold; color: #ffffff;
            justify-content: space-between;
        }

        /* O container onde o Monaco vai morar */
        #monaco-container {
            flex: 1;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* ESTILO DO BOT√ÉO DO SELETOR DE CORES (NOVO) */
        .color-picker-widget {
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            padding: 2px;
        }
        
        .color-picker-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            box-shadow: 0 0 4px rgba(0,0,0,0.5);
            transition: transform 0.1s;
        }

        .color-picker-icon:hover {
            transform: scale(1.1);
            border: 1px solid #ffffff;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span>Lua Code üåï</span>
    </header>
    
    <div id="monaco-container"></div>
</div>

<input type="color" id="hiddenColorPicker" style="display:none;">

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>

<script>
    // SUAS VARI√ÅVEIS ORIGINAIS (INTACTAS)
    const keywords = [
        "print","pairs","ipairs","game","workspace","script","require","typeof","shared","settings",
        "local","end","function","if","then","else","elseif","for","while","do","repeat","until","return","break","continue",
        "true","false","nil","and","not","or","ScreenGui","BillboardGui","SurfaceGui","Frame","ScrollingFrame","CanvasGroup",
        "TextLabel","TextButton","TextBox","ImageLabel","ImageButton","ViewportFrame","VideoFrame","UIListLayout","UIGridLayout",
        "UIPageLayout","UICorner","UIStroke","UIPadding","UIAspectRatioConstraint","UIScale","UISizeConstraint","UITextSizeConstraint",
        "WaitForChild()","FindFirstChild()","FindFirstChildWhichIsA()","GetChildren()","GetDescendants()","Destroy()","Clone()","IsA()",
        "Instance.new()","Color3.new()","Color3.fromRGB()","Color3.fromHSV()","UDim2.new()","UDim.new()","Vector2.new()","Vector3.new()",
        "CFrame.new()","TweenService:Create()","TweenInfo.new()","Tween:Play()","Tween:Pause()","Tween:Cancel()","Name","Parent","Size",
        "Position","AnchorPoint","Rotation","LayoutOrder","ZIndex","Visible","Active","Selectable","AutomaticSize","SizeConstraint",
        "ClipsDescendants","BackgroundColor3","BackgroundTransparency","BorderSizePixel","BorderColor3","Text","TextColor3",
        "TextTransparency","TextSize","Font","RichText","TextWrapped","TextScaled","TextYAlignment","LineHeight","PlaceholderText",
        "PlaceholderColor3","ClearTextOnFocus","CanvasSize","CanvasPosition","ScrollingEnabled","ScrollBarThickness","AutomaticCanvasSize",
        "Image","ImageColor3","ImageTransparency","ScaleType","SliceCenter","SliceScale","TileSize","ResampleMode","Color","Thickness",
        "Transparency","ApplyStrokeMode","LineJoinMode","CornerRadius","PaddingTop","PaddingBottom","PaddingLeft","PaddingRight",
        "MaxSize","MinSize","MaxTextSize","MinTextSize","AspectRatio","AspectType","DominantAxis"
    ];

    // Configurando o Monaco Editor
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});

    require(['vs/editor/editor.main'], function() {
        
        // 1. Criar o provedor de sugest√µes usando SUAS vari√°veis
        monaco.languages.registerCompletionItemProvider('lua', {
            provideCompletionItems: function(model, position) {
                var suggestions = keywords.map(function(word) {
                    
                    var insertText = word;
                    var kind = monaco.languages.CompletionItemKind.Keyword;

                    if (word.includes("()")) {
                        insertText = word.replace("()", "(${1})");
                        kind = monaco.languages.CompletionItemKind.Method;
                    } else if (word.includes(":")) {
                        kind = monaco.languages.CompletionItemKind.Function;
                    } else if (["local", "game", "workspace"].includes(word)) {
                         kind = monaco.languages.CompletionItemKind.Variable;
                    }

                    return {
                        label: word,
                        kind: kind,
                        insertText: insertText,
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: "Comando Roblox Lua: " + word
                    };
                });

                return { suggestions: suggestions };
            }
        });

        // 2. Configura√ß√£o do Tema
        monaco.editor.defineTheme('ultra-dark', {
            base: 'vs-dark',
            inherit: true,
            rules: [
                { token: 'keyword', foreground: '569cd6', fontStyle: 'bold' },
                { token: 'string', foreground: 'ce9178' },
                { token: 'comment', foreground: '6a9955', fontStyle: 'italic' },
                { token: 'number', foreground: 'b5cea8' }
            ],
            colors: {
                'editor.background': '#1e1e1e',
                'editor.foreground': '#d4d4d4',
                'editorLineNumber.foreground': '#858585',
                'editor.selectionBackground': '#264f78',
                'editor.lineHighlightBackground': '#2d2d2d'
            }
        });

        // 3. Inicializa o Editor
        var editor = monaco.editor.create(document.getElementById('monaco-container'), {
            language: 'lua',
            theme: 'ultra-dark',
            automaticLayout: true,
            fontSize: 16,
            fontFamily: "'Consolas', 'Monaco', monospace",
            minimap: { enabled: true },
            scrollBeyondLastLine: false,
            autoClosingBrackets: 'always',
            autoClosingQuotes: 'always',
            formatOnPaste: true
        });

        // =================================================================
        // L√ìGICA DO SELETOR DE CORES (ADICIONADO CONFORME PEDIDO)
        // =================================================================

        var colorWidgetVisible = false;
        var currentMethod = null; // Vai guardar se √© 'fromRGB' ou 'fromHSV'
        var widgetPosition = null;

        // Defini√ß√£o do Widget (Bot√£o flutuante)
        var colorOverlayWidget = {
            domNode: null,
            getId: function() {
                return 'my.color.picker.widget';
            },
            getDomNode: function() {
                if (!this.domNode) {
                    this.domNode = document.createElement('div');
                    this.domNode.className = 'color-picker-widget';
                    
                    // √çcone solicitado
                    var img = document.createElement('img');
                    img.src = "https://uploadnow.io/f/6RcD8JM";
                    img.className = 'color-picker-icon';
                    img.title = "Escolher Cor";
                    
                    // Ao clicar no √≠cone, clica no input invis√≠vel
                    img.onclick = function() {
                        document.getElementById('hiddenColorPicker').click();
                    };
                    
                    this.domNode.appendChild(img);
                }
                return this.domNode;
            },
            getPosition: function() {
                return {
                    position: widgetPosition,
                    preference: [monaco.editor.ContentWidgetPositionPreference.EXACT]
                };
            }
        };

        // Adiciona o widget ao editor (invis√≠vel inicialmente)
        editor.addContentWidget(colorOverlayWidget);

        // Monitora onde o cursor est√°
        editor.onDidChangeCursorPosition(function(e) {
            var position = e.position;
            var model = editor.getModel();
            var lineContent = model.getLineContent(position.lineNumber);
            
            // Verifica o texto antes do cursor
            // Pega tudo do come√ßo da linha at√© a posi√ß√£o do cursor
            var textBeforeCursor = lineContent.substring(0, position.column - 1);

            // Express√µes Regulares para detectar se estamos dentro dos parenteses
            // Verifica se termina com "Color3.fromRGB(" ou "Color3.fromHSV("
            // Aceita espa√ßos eventuais ex: Color3.fromRGB( 
            var rgbMatch = textBeforeCursor.match(/Color3\.fromRGB\s*\(\s*$/);
            var hsvMatch = textBeforeCursor.match(/Color3\.fromHSV\s*\(\s*$/);

            if (rgbMatch) {
                currentMethod = 'RGB';
                widgetPosition = position;
                editor.layoutContentWidget(colorOverlayWidget);
                // Pequeno truque CSS para mostrar ou esconder se necess√°rio, 
                // mas o layoutContentWidget j√° cuida da posi√ß√£o.
                colorOverlayWidget.getDomNode().style.display = 'block';
                colorWidgetVisible = true;
            } 
            else if (hsvMatch) {
                currentMethod = 'HSV';
                widgetPosition = position;
                editor.layoutContentWidget(colorOverlayWidget);
                colorOverlayWidget.getDomNode().style.display = 'block';
                colorWidgetVisible = true;
            } 
            else {
                // Esconde se sair dos parenteses
                if (colorWidgetVisible) {
                    colorOverlayWidget.getDomNode().style.display = 'none';
                    colorWidgetVisible = false;
                }
            }
        });

        // Monitora a mudan√ßa de cor no Input Invis√≠vel
        document.getElementById('hiddenColorPicker').addEventListener('input', function(e) {
            var hex = e.target.value; // Formato #RRGGBB
            var finalString = "";

            // Converte HEX para RGB num√©rico
            var r = parseInt(hex.substr(1, 2), 16);
            var g = parseInt(hex.substr(3, 2), 16);
            var b = parseInt(hex.substr(5, 2), 16);

            if (currentMethod === 'RGB') {
                // Formato: 255, 255, 255
                finalString = r + ", " + g + ", " + b;
            } else if (currentMethod === 'HSV') {
                // Formato Roblox: 0 a 1
                // Convers√£o de RGB (0-255) para HSV (0-1)
                var rNorm = r / 255, gNorm = g / 255, bNorm = b / 255;
                var max = Math.max(rNorm, gNorm, bNorm), min = Math.min(rNorm, gNorm, bNorm);
                var h, s, v = max;
                var d = max - min;
                
                s = max === 0 ? 0 : d / max;

                if (max === min) {
                    h = 0; // acrom√°tico
                } else {
                    switch (max) {
                        case rNorm: h = (gNorm - bNorm) / d + (gNorm < bNorm ? 6 : 0); break;
                        case gNorm: h = (bNorm - rNorm) / d + 2; break;
                        case bNorm: h = (rNorm - gNorm) / d + 4; break;
                    }
                    h /= 6;
                }

                // Arredondar para 3 casas decimais para ficar limpo
                var hF = h.toFixed(3);
                var sF = s.toFixed(3);
                var vF = v.toFixed(3);
                
                finalString = hF + ", " + sF + ", " + vF;
            }

            // Inserir o texto no editor
            if (widgetPosition) {
                // Precisamos saber se j√° tem texto dentro para substituir ou apenas inserir
                // Simplifica√ß√£o: Insere na posi√ß√£o do cursor.
                // O snippet do Monaco seleciona o interior, ent√£o "executeEdits" substitui a sele√ß√£o.
                
                var p = widgetPosition;
                var selection = editor.getSelection();

                editor.executeEdits("color-picker", [{
                    range: selection,
                    text: finalString,
                    forceMoveMarkers: true
                }]);
            }
        });

    });
</script>

</body>
</html>
